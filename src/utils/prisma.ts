import 'dotenv/config';
import { PrismaClient } from '@prisma/client';
import { PrismaPg } from '@prisma/adapter-pg';

const connectionString = process.env.DATABASE_URL!;

const adapter = new PrismaPg({ connectionString });
const prisma = new PrismaClient({ adapter });

export { prisma };

/*
–ë–¥–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ —Ä–µ—à–µ–Ω–∏—é –º—ã –∏–∑–±–µ–≥–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ PrismaClient –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –∏—Å—á–µ—Ä–ø–∞–Ω–∏—é —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö.
–≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –∏–º–µ–µ—Ç –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ "singleton pattern".

*/


/*
1.1 –ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
  import 'dotenv/config'  
  –ü–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞ –≤ process.env.
  –¢–æ –µ—Å—Ç—å process.env.DATABASE_URL –±–µ—Ä—ë—Ç—Å—è –∏–∑ .env.

1.2 @prisma/adapter-pg + PrismaClient
  PrismaClient ‚Äî –≥–ª–∞–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç ORM Prisma.
  PrismaPg ‚Äî –∞–¥–∞–ø—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–∫–ª—é—á–∞–µ—Ç Prisma –∫ pg (PostgreSQL driver).
  –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã Prisma —Å–∞–º —Å–æ–∑–¥–∞–≤–∞–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ, —Ç—ã —è–≤–Ω–æ –ø—Ä–æ–∫–∏–¥—ã–≤–∞–µ—à—å –∞–¥–∞–ø—Ç–µ—Ä —Å connectionString.

1.3. connectionString = process.env.DATABASE_URL!
  –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ (postgres://user:pass@host:port/db).
  ! –≥–æ–≤–æ—Ä–∏—Ç TypeScript: "—è —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —ç—Ç–æ –Ω–µ undefined".

1.4 Singleton-–ø–æ–¥—Ö–æ–¥ (–ø–∞—Ç—Ç–µ—Ä–Ω –æ–¥–∏–Ω–æ—á–∫–∏)
  –¢—ã —Å–æ–∑–¥–∞—ë—à—å –æ–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä PrismaClient –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—à—å –µ–≥–æ.
  –ü–æ—Ç–æ–º –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—à—å –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –æ–±—ä–µ–∫—Ç prisma.
  –≠—Ç–æ –≤–∞–∂–Ω–æ –≤ dev-—Ä–µ–∂–∏–º–µ: –µ—Å–ª–∏ –ø—Ä–∏ hot reload –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–π PrismaClient, –±—É–¥—É—Ç —É—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –ë–î –∏ –æ—à–∏–±–∫–∞ too many connections.
  üß† –ò–¥–µ—è: –æ–¥–∏–Ω –ø—Ä–æ—Ü–µ—Å—Å ‚Üí –æ–¥–∏–Ω PrismaClient ‚Üí –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
*/
